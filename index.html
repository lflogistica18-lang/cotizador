<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cotizador - Control de Plagas</title>
<link rel="stylesheet" href="css/styles.css">
</head>
<body>
<button class="hamburger" onclick="toggleSidebar()">&#9776;</button>
<div class="sidebar-overlay" onclick="toggleSidebar()"></div>
<div class="app-wrapper">
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo-placeholder">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      </div>
      <div class="user-name">Usuario</div>
    </div>
    <nav class="sidebar-nav">
      <a href="#"><span class="nav-icon"></span> Asistente de Ventas</a>
      <a href="#" class="active"><span class="nav-icon"></span> Cotizador</a>
      <a href="#"><span class="nav-icon"></span> Generador de Propuestas</a>
      <a href="#"><span class="nav-icon"></span> Certificados de Productos</a>
    </nav>
  </aside>
  <main class="main-content">
    <header class="header">
      <div>
        <h1>Cotizador de Control de Plagas</h1>
        <div class="precios-info" id="preciosInfo"></div>
      </div>
    </header>
    <section class="container">
      <div class="step-indicator" id="stepIndicator"></div>

      <!-- PASO 1: Tipo de cliente -->
      <section class="step active" id="step1">
        <h2>Paso 1 - Tipo de cliente</h2>
        <p class="step-hint">Selecciona el periodo de contratacion (anual, semestral, trimestral o mensual) y si el cliente tiene una o varias ubicaciones. El contrato anual/semestral/trimestral muestra el valor total del periodo en la cotizacion.</p>
        <label>Tipo de contratacion</label>
        <div class="row" style="margin-top:10px">
          <div>
            <select id="tipoContrato">
              <option value="12">Anual (12 meses)</option>
              <option value="6">Semestral (6 meses)</option>
              <option value="3">Trimestral (3 meses)</option>
              <option value="1">Mensual (1 mes)</option>
            </select>
          </div>
        </div>
        <label style="margin-top:14px">Cantidad de ubicaciones del cliente</label>
        <div class="row" style="margin-top:10px">
          <div>
            <select id="tipoCliente">
              <option value="unica">Ubicacion unica</option>
              <option value="multiple">Multiples sucursales</option>
            </select>
          </div>
          <div id="cantUbicacionesWrap" class="hidden">
            <input type="number" id="cantUbicaciones" min="2" max="20" value="2" placeholder="Cant. ubicaciones">
          </div>
        </div>
        <div class="btn-group"><button class="btn btn-primary" onclick="goStep2()">Siguiente</button></div>
      </section>

      <!-- PASO 2: Ubicaciones -->
      <section class="step" id="step2">
        <h2>Paso 2 - Datos de ubicaciones</h2>
        <p class="step-hint">Completa los datos basicos de cada ubicacion. La frecuencia define las visitas mensuales por defecto: Semanal = 4,5 | Quincenal = 2 | Mensual = 1. Se puede ajustar en el paso siguiente.</p>
        <div id="ubicacionesForms"></div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="showStep(1)">Atras</button>
          <button class="btn btn-primary" onclick="goStep3()">Siguiente</button>
        </div>
      </section>

      <!-- PASO 3: Detalle operativo -->
      <section class="step" id="step3">
        <h2>Paso 3 - Detalle operativo</h2>
        <p class="step-hint">Define horas, operarios y visitas regulares para cada ubicacion. Si el servicio incluye visitas adicionales fuera de las regulares (ej: control de mosquitos en temporada, servicio de emergencia, refuerzo por auditoria), activalas en la seccion de visitas extraordinarias. Estas pueden bonificarse si se ofrecen sin cargo.</p>
        <div id="operativoForms"></div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="showStep(2)">Atras</button>
          <button class="btn btn-primary" onclick="goStep4()">Siguiente</button>
        </div>
      </section>

      <!-- PASO 4: Insumos -->
      <section class="step" id="step4">
        <h2>Paso 4 - Insumos por ubicacion</h2>
        <p class="step-hint">Selecciona los insumos necesarios para cada ubicacion. Marca como <strong>Unico</strong> los que se instalan una sola vez (ej: trampas, cajas cebadera) y <strong>Mensual</strong> los que se reponen cada mes. Las trampas UV tienen descuento automatico por volumen sumando todas las ubicaciones.</p>
        <div id="insumosForms"></div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="showStep(3)">Atras</button>
          <button class="btn btn-primary" onclick="goStep5()">Siguiente</button>
        </div>
      </section>

      <!-- PASO 5: Horas admin + Condiciones + Descuento global -->
      <section class="step" id="step5">
        <h2>Paso 5 - Horas administrativas, condiciones y descuento</h2>
        <p class="step-hint">Ajustes opcionales: <strong>Horas administrativas</strong> para servicios que requieren gestion extra (informes, coordinacion). <strong>Condiciones particulares</strong> son recargos por situaciones especiales (zona peligrosa, acceso dificil). <strong>Descuento global</strong> se aplica sobre el total del servicio.</p>
        <div class="row">
          <div><label>Horas administrativas mensuales</label><input type="number" id="horasAdmin" min="0" value="0" step="0.5"></div>
          <div><label>Valor hora administrativa</label><input type="text" id="valorHoraAdmin" readonly></div>
        </div>
        <hr style="margin:20px 0;border:none;border-top:1px solid var(--color-border-light)">
        <label>Condiciones particulares</label>
        <div class="row">
          <div>
            <select id="condTipo">
              <option value="ninguno">Sin condiciones</option>
              <option value="porcentaje">Porcentaje sobre mensual</option>
              <option value="monto_fijo">Monto fijo</option>
            </select>
          </div>
          <div><input type="number" id="condValor" min="0" value="0" placeholder="Valor" disabled></div>
        </div>
        <div id="condDescWrap" class="hidden" style="margin-top:10px">
          <label>Motivo / descripcion</label>
          <input type="text" id="condDesc" placeholder="Ej: cliente dificil, zona peligrosa...">
        </div>
        <hr style="margin:20px 0;border:none;border-top:1px solid var(--color-border-light)">
        <label>Descuento global</label>
        <div class="row">
          <div><label>% Descuento global</label><input type="number" id="descGlobal" min="0" max="100" value="0" step="0.5"></div>
          <div><label>Motivo del descuento</label><input type="text" id="descGlobalMotivo" placeholder="Ej: cliente nuevo, promocion..."></div>
        </div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="showStep(4)">Atras</button>
          <button class="btn btn-primary" onclick="goStep6()">Calcular</button>
        </div>
      </section>

      <!-- PASO 6: Resumen costos -->
      <section class="step" id="step6">
        <h2>Paso 6 - Resumen de costos</h2>
        <p class="step-hint">Revisa que los numeros sean correctos antes de continuar. Si necesitas ajustar algo, usa el boton "Modificar" para volver al paso anterior.</p>
        <div id="resumenCostos"></div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="showStep(5)">Modificar</button>
          <button class="btn btn-primary" onclick="goStep7()">Confirmar y completar datos del cliente</button>
        </div>
      </section>

      <!-- PASO 7: Datos del cliente -->
      <section class="step" id="step7">
        <h2>Paso 7 - Datos del cliente</h2>
        <p class="step-hint">Completa los datos del cliente para la cotizacion formal. Si aun no tenes todos los datos, podes dejarlos en blanco y completarlos despues.</p>
        <label>Razon Social</label>
        <input type="text" id="razonSocial">
        <div class="row">
          <div><label>CUIT (XX-XXXXXXXX-X)</label><input type="text" id="cuit" placeholder="30-12345678-9"></div>
          <div><label>Telefono de contacto</label><input type="text" id="telefono"></div>
        </div>
        <div class="row">
          <div><label>Nombre del contacto</label><input type="text" id="contactoNombre"></div>
          <div><label>Cargo</label><input type="text" id="contactoCargo"></div>
        </div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="showStep(6)">Atras</button>
          <button class="btn btn-success" onclick="generarCotizacion()">Generar cotizacion</button>
        </div>
      </section>

      <!-- PASO 8: Cotizacion final -->
      <section class="step" id="step8">
        <h2>Cotizacion generada</h2>
        <p class="step-hint">La cotizacion se abrio en una nueva ventana. Podes descargarla como PDF o TXT, o volver a abrirla si se cerro. Para imprimir desde la ventana de cotizacion usa Ctrl+P.</p>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="showStep(7)">Atras</button>
          <button class="btn btn-primary" onclick="abrirCotizacion()">Volver a abrir cotizacion</button>
          <button class="btn btn-primary" onclick="descargarPDF()">Guardar como PDF</button>
          <button class="btn btn-danger" onclick="descargarTXT()">Descargar TXT</button>
          <button class="btn btn-success" onclick="location.reload()">Nueva cotizacion</button>
        </div>
      </section>
    </section>
  </main>
</div>

<!-- JavaScript Modules -->
<script src="js/data.js"></script>
<script src="js/utils.js"></script>
<script src="js/ui.js"></script>
<script src="js/calc.js"></script>
<script src="js/output.js?v=7"></script>
<script src="js/app.js"></script>
</body>
</html>
